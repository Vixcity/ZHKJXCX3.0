{"version":3,"sources":["../src/dropdown-menu/dropdown-item.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EAAoB,cAAc,EAAE,WAAW,EAAE,MAAM,qBAAqB,CAAC;AACpF,OAAO,MAAM,MAAM,kBAAkB,CAAC;AACtC,OAAO,KAAK,MAAM,uBAAuB,CAAC;AAC1C,OAAO,SAAS,MAAM,SAAS,CAAC;AAEhC,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,iBAAiB,CAAC;AAE/C,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,CAAC;AAC1B,MAAM,IAAI,GAAG,GAAG,MAAM,gBAAgB,CAAC;AAIvC,IAAqB,gBAAgB,GAArC,MAAqB,gBAAiB,SAAQ,cAAc;IAA5D;;QACE,eAAU,qBACL,KAAK,EACR;QAEF,SAAI,GAAG;YACL,MAAM;YACN,WAAW,EAAE,IAAI;YACjB,IAAI,EAAE,KAAK;YACX,GAAG,EAAE,IAAI;YACT,GAAG,EAAE,CAAC;YACN,UAAU,EAAE,CAAC;YACb,cAAc,EAAE,EAAE;YAClB,SAAS,EAAE,CAAC;YACZ,WAAW,EAAE,EAAE;YACf,SAAS,EAAE,IAAI;YACf,UAAU,EAAE,KAAK;YACjB,QAAQ,EAAE,SAAS,CAAC,QAAQ,CAAC,KAAK;YAClC,MAAM,EAAE,SAAS,CAAC,MAAM,CAAC,KAAK;YAC9B,OAAO,EAAE,SAAS,CAAC,OAAO,CAAC,KAAK;SACjC,CAAC;QAEF,cAAS,GAAqB;YAC5B,iBAAiB,EAAE;gBACjB,IAAI,EAAE,QAAQ;gBACd,MAAM,CAAC,MAAM;oBACX,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,GAAG,MAAM,CAAC,UAAU,CAAC;oBAExD,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;oBAC7B,IAAI,CAAC,OAAO,CAAC;wBACX,GAAG,EAAE,MAAM;wBACX,MAAM;wBACN,QAAQ;wBACR,OAAO;qBACR,CAAC,CAAC;gBACL,CAAC;aACF;SACF,CAAC;QAEF,oBAAe,GAAG;YAChB;gBACE,GAAG,EAAE,OAAO;gBACZ,KAAK,EAAE,QAAQ;aAChB;SACF,CAAC;QAEF,cAAS,GAAG;YACV,KAAK,CAAC,CAAC;gBACL,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;oBACtB,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;wBAAE,MAAM,SAAS,CAAC,gBAAgB,CAAC,CAAC;iBAC1D;gBAED,IAAI,IAAI,CAAC,IAAI,CAAC,aAAa,KAAK,MAAM,EAAE;oBACtC,IAAI,CAAC,gBAAgB,EAAE,CAAC;iBACzB;YACH,CAAC;YACD,kBAAkB,CAAC,EAAE,EAAE,EAAE;gBACvB,IAAI,CAAC,OAAO,CAAC;oBACX,UAAU,EAAE,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,CAAC;iBAC3B,CAAC,CAAC;YACL,CAAC;SACF,CAAC;QAEF,cAAS,GAAG;YACV,QAAQ;gBACN,MAAM,EAAE,QAAQ,EAAE,aAAa,EAAE,KAAK,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC;gBACnE,MAAM,MAAM,GAAG,aAAa,KAAK,MAAM,CAAC;gBACxC,MAAM,iBAAiB,GAAG;oBACxB,CAAC,GAAG,MAAM,UAAU,CAAC,EAAE,MAAM;oBAC7B,CAAC,GAAG,MAAM,YAAY,CAAC,EAAE,CAAC,MAAM,IAAI,CAAC,QAAQ;oBAC7C,CAAC,GAAG,MAAM,WAAW,CAAC,EAAE,CAAC,MAAM,IAAI,QAAQ;iBAC5C,CAAC;gBACF,MAAM,cAAc,GAAG,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC;qBAClD,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC;qBAC5C,IAAI,CAAC,GAAG,CAAC,CAAC;gBAEb,IAAI,CAAC,OAAO,CAAC;oBACX,cAAc;oBACd,SAAS,EAAE,KAAK,CAAC,KAAK,IAAI,YAAY,CAAC;iBACxC,CAAC,CAAC;YACL,CAAC;SACF,CAAC;QAEF,YAAO,GAAG;YACR,gBAAgB;gBACd,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC;gBAC/C,MAAM,WAAW,GAAG,EAAE,CAAC;gBACvB,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC;gBACf,IAAI,IAAI,GAAG,EAAE,OAAO,EAAE,CAAC;gBAEvB,OAAO,IAAI,IAAI,IAAI,CAAC,OAAO,EAAE;oBAC3B,KAAK,IAAI,CAAC,CAAC;oBACX,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC;oBAC1B,MAAM,SAAS,GAAG,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAG,KAAK,CAAC,CAAC;oBAEjC,WAAW,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC;oBAE5B,IAAI,SAAS,IAAI,IAAI,EAAE;wBACrB,MAAM,CAAC,UAAU,CAAC,GAAG,IAAI,CAAC;wBAC1B,IAAI,GAAG,UAAU,CAAC;qBACnB;yBAAM;wBACL,MAAM,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,KAAK,KAAK,SAAS,CAAC,CAAC;wBAC9D,IAAI,GAAG,KAAK,aAAL,KAAK,cAAL,KAAK,GAAI,IAAI,CAAC,CAAC,CAAC,CAAC;qBACzB;iBACF;gBAED,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;gBAErC,IAAI,QAAQ,EAAE;oBACZ,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC;oBAC7D,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,EAAE;wBACzC,MAAM,SAAS,CAAC,gBAAgB,CAAC,CAAC;qBACnC;iBACF;gBAED,IAAI,CAAC,OAAO,CAAC;oBACX,SAAS;oBACT,WAAW;iBACZ,CAAC,CAAC;YACL,CAAC;YAED,aAAa;gBACX,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC;oBACpB,SAAS,EAAE,CAAC,CAAC;iBACd,CAAC,CAAC;gBACH,IAAI,CAAC,OAAO,CAAC;oBACX,IAAI,EAAE,KAAK;iBACZ,CAAC,CAAC;YACL,CAAC;YAED,eAAe,CAAC,MAAM;gBACpB,MAAM,KAAK,GAAG,EAAE,CAAC,mBAAmB,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;gBAClD,KAAK;qBACF,MAAM,CAAC,IAAI,MAAM,MAAM,CAAC;qBACxB,kBAAkB,CAAC,CAAC,GAAG,EAAE,EAAE;oBAC1B,IAAI,CAAC,OAAO,CAAC;wBACX,GAAG,EAAE,GAAG,CAAC,MAAM;wBACf,UAAU,EAAE,GAAG,CAAC,GAAG;qBACpB,CAAC,CAAC;gBACL,CAAC,CAAC;qBACD,IAAI,EAAE,CAAC;YACZ,CAAC;YAED,eAAe,CAAC,CAAC;gBACf,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,CAAC,CAAC,aAAa,CAAC,OAAO,CAAC;gBAC5D,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC;gBAE5B,KAAK,CAAC,KAAK,CAAC,GAAG,SAAS,CAAC;gBACzB,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YACrC,CAAC;YAED,iBAAiB,CAAC,CAAC;gBACjB,IAAI,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC;gBAC1B,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,CAAC,CAAC,MAAM,CAAC;gBACtC,MAAM,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC;gBAEnC,IAAI,IAAI,CAAC,IAAI,CAAC,aAAa,KAAK,MAAM,EAAE;oBACtC,KAAK,CAAC,KAAK,CAAC,GAAG,SAAS,CAAC;iBAC1B;qBAAM;oBACL,KAAK,GAAG,SAAS,CAAC;iBACnB;gBAED,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YACrC,CAAC;YAED,eAAe;gBACb,MAAM,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC;gBAE1B,IAAI,GAAG,IAAI,GAAG,CAAC,UAAU,CAAC,mBAAmB,EAAE;oBAC7C,IAAI,CAAC,aAAa,EAAE,CAAC;iBACtB;YACH,CAAC;YAED,WAAW;gBACT,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,EAAE,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;YACjE,CAAC;YAED,aAAa;gBACX,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;gBACrD,IAAI,CAAC,aAAa,EAAE,CAAC;YACvB,CAAC;SACF,CAAC;IACJ,CAAC;CAAA,CAAA;AAtLoB,gBAAgB;IADpC,WAAW,EAAE;GACO,gBAAgB,CAsLpC;eAtLoB,gBAAgB","file":"dropdown-item.js","sourcesContent":["import { RelationsOptions, SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport props from './dropdown-item-props';\nimport menuProps from './props';\nimport type { TdDropdownItemProps } from './type';\nimport { equal, clone } from '../common/utils';\n\nconst { prefix } = config;\nconst name = `${prefix}-dropdown-item`;\n\nexport interface DropdownItemProps extends TdDropdownItemProps {}\n@wxComponent()\nexport default class DropdownMenuItem extends SuperComponent {\n  properties = {\n    ...props,\n  };\n\n  data = {\n    prefix,\n    classPrefix: name,\n    show: false,\n    bar: null,\n    top: 0,\n    maskHeight: 0,\n    contentClasses: '',\n    leafLevel: 0,\n    treeOptions: [],\n    initValue: null,\n    hasChanged: false,\n    duration: menuProps.duration.value,\n    zIndex: menuProps.zIndex.value,\n    overlay: menuProps.overlay.value,\n  };\n\n  relations: RelationsOptions = {\n    './dropdown-menu': {\n      type: 'parent',\n      linked(target) {\n        const { zIndex, duration, overlay } = target.properties;\n\n        this.getParentBottom(target);\n        this.setData({\n          bar: target,\n          zIndex,\n          duration,\n          overlay,\n        });\n      },\n    },\n  };\n\n  controlledProps = [\n    {\n      key: 'value',\n      event: 'change',\n    },\n  ];\n\n  observers = {\n    value(v) {\n      if (this.data.multiple) {\n        if (!Array.isArray(v)) throw TypeError('应传入数组类型的 value');\n      }\n\n      if (this.data.optionsLayout === 'tree') {\n        this.buildTreeOptions();\n      }\n    },\n    'initValue, value'(v1, v2) {\n      this.setData({\n        hasChanged: !equal(v1, v2),\n      });\n    },\n  };\n\n  lifetimes = {\n    attached() {\n      const { multiple, optionsLayout, value, defaultValue } = this.data;\n      const isTree = optionsLayout === 'tree';\n      const contentClassesObj = {\n        [`${prefix}-is-tree`]: isTree,\n        [`${prefix}-is-single`]: !isTree && !multiple,\n        [`${prefix}-is-multi`]: !isTree && multiple,\n      };\n      const contentClasses = Object.keys(contentClassesObj)\n        .filter((e) => contentClassesObj[e] === true)\n        .join(' ');\n\n      this.setData({\n        contentClasses,\n        initValue: clone(value || defaultValue),\n      });\n    },\n  };\n\n  methods = {\n    buildTreeOptions() {\n      const { options, value, multiple } = this.data;\n      const treeOptions = [];\n      let level = -1;\n      let node = { options };\n\n      while (node && node.options) {\n        level += 1;\n        const list = node.options;\n        const thisValue = value?.[level];\n\n        treeOptions.push([...list]);\n\n        if (thisValue == null) {\n          const [firstChild] = list;\n          node = firstChild;\n        } else {\n          const child = list.find((child) => child.value === thisValue);\n          node = child ?? list[0];\n        }\n      }\n\n      const leafLevel = Math.max(0, level);\n\n      if (multiple) {\n        const finalValue = this.data.value || this.data.defaultValue;\n        if (!Array.isArray(finalValue[leafLevel])) {\n          throw TypeError('应传入数组类型的 value');\n        }\n      }\n\n      this.setData({\n        leafLevel,\n        treeOptions,\n      });\n    },\n\n    closeDropdown() {\n      this.data.bar.setData({\n        activeIdx: -1,\n      });\n      this.setData({\n        show: false,\n      });\n    },\n\n    getParentBottom(parent) {\n      const query = wx.createSelectorQuery().in(parent);\n      query\n        .select(`#${prefix}-bar`)\n        .boundingClientRect((res) => {\n          this.setData({\n            top: res.bottom,\n            maskHeight: res.top,\n          });\n        })\n        .exec();\n    },\n\n    handleTreeClick(e) {\n      const { level, value: itemValue } = e.currentTarget.dataset;\n      const { value } = this.data;\n\n      value[level] = itemValue;\n      this._trigger('change', { value });\n    },\n\n    handleRadioChange(e) {\n      let { value } = this.data;\n      const { value: itemValue } = e.detail;\n      const { level } = e.target.dataset;\n\n      if (this.data.optionsLayout === 'tree') {\n        value[level] = itemValue;\n      } else {\n        value = itemValue;\n      }\n\n      this._trigger('change', { value });\n    },\n\n    handleMaskClick() {\n      const { bar } = this.data;\n\n      if (bar && bar.properties.closeOnClickOverlay) {\n        this.closeDropdown();\n      }\n    },\n\n    handleReset() {\n      this._trigger('change', { value: clone(this.data.initValue) });\n    },\n\n    handleConfirm() {\n      this._trigger('confirm', { value: this.data.value });\n      this.closeDropdown();\n    },\n  };\n}\n"]}