<!--pages/order/order.wxml-->
<view id="order">
	<nav-content showBack="{{false}}">
		<view slot="after">
			订单列表
		</view>
	</nav-content>

	<view class="bgColorWhite">
		<view class="flex aic">
			<l-input class="w80" bind:lininput="confirmData" data-type="keyword" placeholder="单据编号/产品编号/产品名"
				hide-label="{{true}}" />
			<view class="w20 color6 flex aic" bindtap="openPopup">
				<view>筛选</view>
				<t-icon name="menu-unfold" size="xl" bind:click="someFunction" />
			</view>
		</view>
	</view>

	<scroll-view scroll-y class="vh80" bindscrolltolower="reqOrder">
		<view class="card fz25" wx:for="{{orderList}}" wx:for-item="item" wx:key="item" wx:for-index="index"
			data-item="{{item}}" bindtap="toDetail">
			<view class="flex w100 jcsb">
				<view class="bold fz30">{{item.code || '未填写'}}</view>
				<view>
					<view wx:if="{{item.status === 1}}" style="border-radius: 500px;"
						class="pl10 pr10 pt5 pb5 colorWhite bgColorOrange">已创建</view>
					<view wx:if="{{item.status === 2}}" style="border-radius: 500px;"
						class="pl10 pr10 pt5 pb5 colorWhite bgColor27A2">进行中</view>
					<view wx:if="{{item.status === 3}}" style="border-radius: 500px;"
						class="pl10 pr10 pt5 pb5 colorWhite bgColor03d0">已完成</view>
					<view wx:if="{{item.status === 4}}" style="border-radius: 500px;"
						class="pl10 pr10 pt5 pb5 colorWhite bgColor03d0">已结算</view>
					<view wx:if="{{item.status === 5}}" style="border-radius: 500px;"
						class="pl10 pr10 pt5 pb5 colorWhite bgColorRed">已逾期</view>
					<view wx:if="{{item.status === 6}}" style="border-radius: 500px;"
						class="pl10 pr10 pt5 pb5 colorWhite bgColorRed">已取消</view>
				</view>
			</view>
			<view>{{item.client_name || '未填写'}}</view>
			<view class="flex mt10">
				<image style="align-self: flex-end;"
					src="{{item.product_data[0].image_data[0] || 'https://file.zwyknit.com/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20220211103236.png'}}"
					class="image" />
				<view class="pl10 w100 flex fdc jcsb">
					<view class="flex aic jcsb">
						<view>{{item.group_name || '未填写'}}</view>
						<view style="transform: translateY(-15%)">
							<view class="w100 flex jcsa">
								<!-- 报 -->
								<view wx:if="{{item.has_quote.status===1}}" class="ml5 iconfont icon-baojiadan1 color03d0 fz40"></view>
								<view wx:if="{{item.has_quote.status===2}}" class="ml5 iconfont icon-baojiadan1 color9E fz40"></view>
								<view wx:if="{{item.has_quote.status===3}}" class="ml5 iconfont icon-baojiadan1 colorOrange fz40">
								</view>
								<!-- 计 -->
								<view wx:if="{{item.has_material_plan.status===1}}"
									class="ml5 iconfont icon-yuanliaojihua1 color03d0 fz40"></view>
								<view wx:if="{{item.has_material_plan.status===2}}"
									class="ml5 iconfont icon-yuanliaojihua1 color9E fz40">
								</view>
								<view wx:if="{{item.has_material_plan.status===3}}"
									class="ml5 iconfont icon-yuanliaojihua1 colorOrange fz40"></view>
								<!-- 采 -->
								<view wx:if="{{item.has_material_order.status===1}}"
									class="ml5 iconfont icon-yuanliaocaigou1 color03d0 fz40"></view>
								<view wx:if="{{item.has_material_order.status===2}}"
									class="ml5 iconfont icon-yuanliaocaigou1 color9E fz40"></view>
								<!-- 入 -->
								<view wx:if="{{item.push_progress.progress===100||item.push_progress.progress>100}}"
									class="ml5 iconfont icon-yuanliaoruku1 color03d0 fz40"></view>
								<view wx:if="{{item.push_progress.progress>0 && item.push_progress.progress<100}}"
									class="ml5 iconfont icon-yuanliaoruku1 colorOrange fz40"></view>
								<view wx:if="{{!item.push_progress.progress}}" class="ml5 iconfont icon-yuanliaoruku1 color9E fz40">
								</view>
								<!-- 出 -->
								<view wx:if="{{item.pop_progress.progress===100||item.pop_progress.progress>100}}"
									class="ml5 iconfont icon-yuanliaochuku1 color03d0 fz40"></view>
								<view wx:if="{{item.pop_progress.progress>0 && item.pop_progress.progress<100}}"
									class="ml5 iconfont icon-yuanliaochuku1 colorOrange fz40"></view>
								<view wx:if="{{!item.pop_progress.progress}}" class="ml5 iconfont icon-yuanliaochuku1 color9E fz40">
								</view>
							</view>
							<view class="w100 flex jcsa mt5">
								<!-- 产 -->
								<view wx:if="{{item.has_weave_plan.status===1}}"
									class="ml5 iconfont icon-shengchanjihua3 color03d0 fz40"></view>
								<view wx:if="{{item.has_weave_plan.status===2}}" class="ml5 iconfont icon-shengchanjihua3 color9E fz40">
								</view>
								<!-- 检 -->
								<view
									wx:if="{{item.inspection_push_progress.progress===100||item.inspection_push_progress.progress>100}}"
									class="ml5 iconfont icon-jianyanchuku color03d0 fz40"></view>
								<view wx:if="{{item.inspection_push_progress.progress>0 && item.inspection_push_progress.progress<100}}"
									class="ml5 iconfont icon-jianyanchuku colorOrange fz40"></view>
								<view wx:if="{{!item.inspection_push_progress.progress}}"
									class="ml5 iconfont icon-jianyanchuku color9E fz40"></view>
								<!-- 包 -->
								<view wx:if="{{item.has_pack_order.status===1}}"
									class="ml5 iconfont icon-baozhuangcaigou1 color03d0 fz40"></view>
								<view wx:if="{{item.has_pack_order.status===2}}"
									class="ml5 iconfont icon-baozhuangcaigou1 color9E fz40">
								</view>
								<!-- 箱 -->
								<view wx:if="{{item.transport_progress>=100}}"
									class="ml5 iconfont icon-zhuangxiangchuku1 color03d0 fz40"></view>
								<view wx:if="{{item.transport_progress>0&&item.transport_progress<100}}"
									class="ml5 iconfont icon-zhuangxiangchuku1 colorOrange fz40"></view>
								<view wx:if="{{item.transport_progress===0}}" class="ml5 iconfont icon-zhuangxiangchuku1 color9E fz40">
								</view>
								<!-- 票 -->
								<view wx:if="{{item.has_invoice.status===1}}" class="ml5 iconfont icon-caiwukaipiao1 color03d0 fz40">
								</view>
								<view wx:if="{{item.has_invoice.status===2}}" class="ml5 iconfont icon-caiwukaipiao1 color9E fz40">
								</view>
							</view>
						</view>
					</view>
					<view class="flex jcsb">
						<view>下单总数：{{item.total_number}}</view>
						<view>￥{{item.total_price}}</view>
					</view>
				</view>
			</view>
		</view>

		<view wx:if="{{noData}}" class="flex aic fdc jcc vh60">
			<image class="image" src="https://file.zwyknit.com/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20220216112643.png">
			</image>
			<view class="mt20 color91">暂无数据</view>
		</view>
		<view class="vh55" wx:if="{{showLoading && orderList.length === 0}}"></view>
		<l-loadmore show="{{showLoading}}" line="{{true}}" loading-text="努力加载中~"></l-loadmore>
		<l-loadmore show="{{isEnd && orderList.length !== 0}}" type="end" line="{{true}}" end-text="我也是有底线的"></l-loadmore>
	</scroll-view>

	<l-message content="{{content}}" />

	<!-- 筛选 -->
	<van-popup show="{{ showPopup }}" bind:close="closePopup" bind:click-overlay="closePopup" position="right">
		<view class="vh100 vw90 pl20 pr20" style="box-sizing: border-box;">
			<view class="vh12"></view>
			<scroll-view>
				<van-cell title="下单公司" is-link border="{{false}}" bind:click="openPopupSon" value="{{client_name || '全部'}}" />
				<view wx:if="{{client_id}}" class="line"></view>
				<view wx:if="{{client_id}}">公司联系人：</view>
				<view wx:if="{{client_id}}" class="flex">
					<radio-group class="radio-label flex flexWarp" bindchange="bindPickerChangeAge" data-type="contacts">
						<label class="radio" wx:for="{{contactsList}}" wx:key="key">
							<view>
								<view class="label">{{item.text}}</view>
								<radio value="{{index}}" checked="{{item.checked}}" />
							</view>
						</label>
					</radio-group>
				</view>
				<view class="line"></view>
				<view>创建人：</view>
				<view class="flex">
					<radio-group class="radio-label flex flexWarp" bindchange="bindPickerChangeAge" data-type="user">
						<label class="radio" wx:for="{{userList}}" wx:key="key">
							<view>
								<view class="label">{{item.text}}</view>
								<radio value="{{index}}" checked="{{item.checked}}" />
							</view>
						</label>
					</radio-group>
				</view>
				<view class="line"></view>
				<view>负责小组：</view>
				<view class="flex">
					<radio-group class="radio-label flex flexWarp" bindchange="bindPickerChangeAge" data-type="group">
						<label class="radio" wx:for="{{groupList}}" wx:key="key">
							<view>
								<view class="label">{{item.text}}</view>
								<radio value="{{index}}" checked="{{item.checked}}" />
							</view>
						</label>
					</radio-group>
				</view>
				<view class="line"></view>
				<view>订单状态：</view>
				<view class="flex">
					<radio-group class="radio-label flex flexWarp" bindchange="bindPickerChangeAge" data-type="orderstatus">
						<label class="radio" wx:for="{{orderStatusList}}" wx:key="key">
							<view>
								<view class="label">{{item.text}}</view>
								<radio value="{{index}}" checked="{{item.checked}}" />
							</view>
						</label>
					</radio-group>
				</view>
				<view class="line"></view>
				<view>审核状态：</view>
				<view class="flex">
					<radio-group class="radio-label flex flexWarp" bindchange="bindPickerChangeAge" data-type="status">
						<label class="radio" wx:for="{{statusList}}" wx:key="key">
							<view>
								<view class="label">{{item.text}}</view>
								<radio value="{{index}}" checked="{{item.checked}}" />
							</view>
						</label>
					</radio-group>
				</view>
				<view class="line"></view>
				<view>创建时间：</view>
				<view class="flex">
					<radio-group class="radio-label flex flexWarp" bindchange="bindPickerChangeAge" data-type="date">
						<label class="radio" wx:for="{{dateList}}" wx:key="key">
							<view>
								<view class="label">{{item.text}}</view>
								<radio value="{{index}}" checked="{{item.checked}}" />
							</view>
						</label>
					</radio-group>
				</view>
				<view class="vh8"></view>
			</scroll-view>
			<view class="submit small" style="position: sticky;bottom:5%;left:50%;z-index: 2;">
				<view class="flex jcsa">
					<van-button type="primary" size="small" bindtap="reset">重置</van-button>
					<van-button style="margin-left: 20px;" type="primary" size="small" bindtap="confirmData">确认</van-button>
				</view>
			</view>
		</view>
	</van-popup>

	<!-- 筛选子选项 -->
	<van-popup show="{{ showPopupSon }}" bind:close="closePopupSon" bind:click-overlay="closePopupSon" position="right">
		<view class="vh100 vw90 pl20 pr20" style="box-sizing: border-box;">
			<view class="vh12"></view>
			<scroll-view>
				<view class="mt20" wx:for="{{clientList}}">
					<view class="mb20 bold">{{item.text}}</view>
					<van-collapse value="{{ activeName }}" bind:change="changeCollapse">
						<van-collapse-item wx:for="{{item.children}}" wx:for-item="secondClient" title="{{secondClient.text}}"
							name="{{secondClient.id}}">
							<view class="flex flexWarp">
								<van-button class="mt10 ml10" wx:for="{{secondClient.children}}" wx:for-item="thirdClient"
									bind:click="checkClient" data-item="{{thirdClient}}">
									{{thirdClient.text}}
								</van-button>
							</view>
							<view class="tc" wx:if="{{secondClient.children.length === 0}}">暂无数据</view>
						</van-collapse-item>
					</van-collapse>
				</view>
				<view class="vh8"></view>
			</scroll-view>
		</view>
	</van-popup>
</view>